# ๐ RZhD Scripts - ะกะธััะตะผะฐ ะพะฑัะฐะฑะพัะบะธ ะดะฐะฝะฝัั ะะพััะธะนัะบะธั ะถะตะปะตะทะฝัั ะดะพัะพะณ

## ๐ ะะฟะธัะฐะฝะธะต ะฟัะพะตะบัะฐ

ะะฐะฝะฝัะน ัะตะฟะพะทะธัะพัะธะน ัะพะดะตัะถะธั ัะธััะตะผั ะฐะฒัะพะผะฐัะธะทะธัะพะฒะฐะฝะฝะพะน ะพะฑัะฐะฑะพัะบะธ ะดะฐะฝะฝัั ะถะตะปะตะทะฝะพะดะพัะพะถะฝัั ะฟะตัะตะฒะพะทะพะบ ะะะ. ะกะธััะตะผะฐ ะฟัะตะดะฝะฐะทะฝะฐัะตะฝะฐ ะดะปั ะบะพะฝะฒะตััะฐัะธะธ Excel-ัะฐะนะปะพะฒ ั ะพััะตัะฐะผะธ ะพ ะฟะตัะตะฒะพะทะบะฐั ะฒ ััััะบัััะธัะพะฒะฐะฝะฝัะต JSON-ะดะฐะฝะฝัะต ั ะฟะพัะปะตะดัััะตะน ะทะฐะณััะทะบะพะน ะฒ ะฐะฝะฐะปะธัะธัะตัะบะพะต ััะฐะฝะธะปะธัะต.

## โ๏ธ ะัะฝะพะฒะฝะฐั ััะฝะบัะธะพะฝะฐะปัะฝะพััั

### ๐ง ะะปะพะบะธ ัะฐะฑะพั

1. **๐ฆ ะะฑัะฐะฑะพัะบะฐ ะดะฐะฝะฝัั ะะขะ** (`rzhd_ktk.py`) - ะกะฟะตัะธะฐะปะธะทะธัะพะฒะฐะฝะฝะฐั ะพะฑัะฐะฑะพัะบะฐ ะบะพะฝัะตะนะฝะตัะฝัั ะฟะตัะตะฒะพะทะพะบ
2. **๐ ะะถะตะฝะตะดะตะปัะฝะฐั ะพะฑัะฐะฑะพัะบะฐ** (`rzhd_weekly.py`) - ะะณัะตะณะฐัะธั ะตะถะตะฝะตะดะตะปัะฝัั ะพััะตัะพะฒ
3. **๐ ะะฑัะฐะฑะพัะบะฐ ะฟะพ ัะตะณะธะพะฝะฐะผ**:
   - ๐ญ ะะพะฒะพัะพััะธะนัะบ (`rzhd_novorossiysk.sh`)
   - ๐๏ธ ะกะฐะฝะบั-ะะตัะตัะฑััะณ (`rzhd_petersburg.sh`)
4. **โก ะะฐะทะพะฒะฐั ะพะฑัะฐะฑะพัะบะฐ** (`rzhd.py`) - ะัะฝะพะฒะฝะฐั ะปะพะณะธะบะฐ ะบะพะฝะฒะตััะฐัะธะธ ะดะฐะฝะฝัั

### ๐ ะะพะทะผะพะถะฝะพััะธ ัะธััะตะผั

- โ ะะฒัะพะผะฐัะธัะตัะบะธะน ะผะพะฝะธัะพัะธะฝะณ ะฟะฐะฟะพะบ ั ะฒัะพะดััะธะผะธ ัะฐะนะปะฐะผะธ
- โ ะะพะดะดะตัะถะบะฐ ะผะฝะพะถะตััะฒะตะฝะฝัั ัะพัะผะฐัะพะฒ Excel (.xls, .xlsx, .xlsb)
- โ ะะฐะปะธะดะฐัะธั ะธ ะฝะพัะผะฐะปะธะทะฐัะธั ะดะฐะฝะฝัั
- โ ะะฑัะฐะฑะพัะบะฐ ะพัะธะฑะพะบ ั ะปะพะณะธัะพะฒะฐะฝะธะตะผ
- โ ะะฝัะตะณัะฐัะธั ั ClickHouse ะดะปั ััะฐะฝะตะฝะธั ะดะฐะฝะฝัั
- โ ะกะธััะตะผะฐ ัะฒะตะดะพะผะปะตะฝะธะน ัะตัะตะท Telegram
- โ ะะพะฝัะตะนะฝะตัะธะทะฐัะธั ัะตัะตะท Docker

## ๐๏ธ ะััะธัะตะบัััะฐ ัะธััะตะผั

```
rzhd_scripts/
โโโ scripts/                    # Python ะผะพะดัะปะธ
โ   โโโ rzhd.py                # ะะฐะทะพะฒัะน ะบะปะฐัั ะพะฑัะฐะฑะพัะบะธ
โ   โโโ rzhd_ktk.py            # ะะฑัะฐะฑะพัะบะฐ ะะขะ ะดะฐะฝะฝัั
โ   โโโ rzhd_weekly.py         # ะะถะตะฝะตะดะตะปัะฝะฐั ะพะฑัะฐะฑะพัะบะฐ
โ   โโโ headers.py             # Mapping ะทะฐะณะพะปะพะฒะบะพะฒ
โ   โโโ app_logger.py          # ะะพะดัะปั ะปะพะณะธัะพะฒะฐะฝะธั
โ   โโโ __init__.py            # ะะพะฝัะธะณััะฐัะธั ะธ ะบะพะฝััะฐะฝัั
โโโ bash/                      # Bash ัะบัะธะฟัั ะทะฐะฟััะบะฐ
โ   โโโ run_rzhd.sh           # ะะปะฐะฒะฝัะน ัะบัะธะฟั ะทะฐะฟััะบะฐ
โ   โโโ rzhd_ktk.sh           # ะะฑัะฐะฑะพัะบะฐ ะะขะ
โ   โโโ rzhd_novorossiysk.sh  # ะะฑัะฐะฑะพัะบะฐ ะะพะฒะพัะพััะธะนัะบ
โ   โโโ rzhd_petersburg.sh    # ะะฑัะฐะฑะพัะบะฐ ะกะะฑ
โ   โโโ rzhd_weekly.sh        # ะะถะตะฝะตะดะตะปัะฝะฐั ะพะฑัะฐะฑะพัะบะฐ
โโโ Dockerfile                 # ะะพะฝัะธะณััะฐัะธั ะบะพะฝัะตะนะฝะตัะฐ
โโโ docker-compose.yml         # Docker Compose ะบะพะฝัะธะณััะฐัะธั
โโโ requirements.txt           # Python ะทะฐะฒะธัะธะผะพััะธ
โโโ .env                       # ะะตัะตะผะตะฝะฝัะต ะพะบััะถะตะฝะธั
โโโ README.md                 # ะะฐะฝะฝะฐั ะดะพะบัะผะตะฝัะฐัะธั
```

## ๐ป ะขะตัะฝะธัะตัะบะธะน ััะตะบ

### ๐๏ธ ะัะฝะพะฒะฝัะต ัะตัะฝะพะปะพะณะธะธ
- **๐ Python 3.8+** - ะัะฝะพะฒะฝะพะน ัะทัะบ ัะฐะทัะฐะฑะพัะบะธ
- **๐ณ Docker** - ะะพะฝัะตะนะฝะตัะธะทะฐัะธั ะฟัะธะปะพะถะตะฝะธั
- **๐ Bash** - ะกะบัะธะฟัั ะพัะบะตัััะฐัะธะธ
- **๐๏ธ ClickHouse** - ะะฝะฐะปะธัะธัะตัะบะฐั ะฑะฐะทะฐ ะดะฐะฝะฝัั

### ๐ Python ะฑะธะฑะปะธะพัะตะบะธ
```
pandas==1.4.3          # ะะฑัะฐะฑะพัะบะฐ ะดะฐะฝะฝัั
numpy==1.23.3           # ะงะธัะปะตะฝะฝัะต ะฒััะธัะปะตะฝะธั  
openpyxl==3.1.1         # ะะฐะฑะพัะฐ ั .xlsx ัะฐะนะปะฐะผะธ
pyxlsb==1.0.10          # ะะฐะฑะพัะฐ ั .xlsb ัะฐะนะปะฐะผะธ
xlrd==2.0.1             # ะะฐะฑะพัะฐ ั .xls ัะฐะนะปะฐะผะธ
clickhouse-connect==0.5.14  # ะะพะฝะฝะตะบัะพั ะบ ClickHouse
requests~=2.31.0        # HTTP ะทะฐะฟัะพัั
notifiers==1.3.3        # ะฃะฒะตะดะพะผะปะตะฝะธั
python-dotenv==1.0.0    # ะฃะฟัะฐะฒะปะตะฝะธะต ะฟะตัะตะผะตะฝะฝัะผะธ ะพะบััะถะตะฝะธั
```

## ๐ง ะฃััะฐะฝะพะฒะบะฐ ะธ ะฝะฐัััะพะนะบะฐ

### โ ะัะตะดะฒะฐัะธัะตะปัะฝัะต ััะตะฑะพะฒะฐะฝะธั

1. **๐ณ Docker** ะธ **Docker Compose**
2. **๐ Python 3.8+** (ะดะปั ะปะพะบะฐะปัะฝะพะน ัะฐะทัะฐะฑะพัะบะธ)
3. **๐๏ธ ClickHouse** ัะตัะฒะตั (ะดะปั ััะฐะฝะตะฝะธั ะดะฐะฝะฝัั)

### ๐ ะะตัะตะผะตะฝะฝัะต ะพะบััะถะตะฝะธั

ะกะบะพะฟะธััะนัะต ัะฐะนะป `.env.example` ะฒ `.env` ะธ ะทะฐะฟะพะปะฝะธัะต ัะฒะพะธะผะธ ะทะฝะฐัะตะฝะธัะผะธ:

```bash
cp .env.example .env
```

ะะปะธ ัะพะทะดะฐะนัะต ัะฐะนะป `.env` ะฒ ะบะพัะฝะต ะฟัะพะตะบัะฐ ะฒัััะฝัั:

```bash
# ะััะธ ะบ ะดะฐะฝะฝัะผ
XL_IDP_ROOT_RZHD=/path/to/rzhd/scripts
XL_IDP_PATH_RZHD=/path/to/input/data
XL_IDP_PATH_DOCKER=/path/to/docker/data
XL_IDP_PATH_RZHD_SCRIPTS=/path/to/rzhd/scripts

# ClickHouse ะฝะฐัััะพะนะบะธ
CLICKHOUSE_HOST=your_host
CLICKHOUSE_PORT=your_port
CLICKHOUSE_DATABASE=your_database
CLICKHOUSE_USER=your_user
CLICKHOUSE_PASSWORD=your_password

# Telegram ัะฒะตะดะพะผะปะตะฝะธั
TELEGRAM_BOT_TOKEN=your_bot_token
TOKEN_TELEGRAM=your_bot_token
TELEGRAM_CHAT_ID=your_chat_id
```

### ๐ ะกะฑะพัะบะฐ ะธ ะทะฐะฟััะบ

#### ๐ณ Docker Compose (ัะตะบะพะผะตะฝะดัะตะผัะน ัะฟะพัะพะฑ)

1. **๐จ ะกะฑะพัะบะฐ ะธ ะทะฐะฟััะบ ั Docker Compose:**

```yaml
version: "3.9"
services:
    rzhd:
        container_name: rzhd
        restart: always
        ports:
        - "8100:8100"
        volumes:
        - ${XL_IDP_PATH_RZHD_SCRIPTS}:${XL_IDP_PATH_DOCKER}
        - ${XL_IDP_ROOT_RZHD}:${XL_IDP_PATH_RZHD}
        environment:
        XL_IDP_ROOT_RZHD: ${XL_IDP_PATH_DOCKER}
        XL_IDP_PATH_RZHD: ${XL_IDP_PATH_RZHD}
        TOKEN_TELEGRAM: ${TOKEN_TELEGRAM}
        build:
        context: rzhd
        dockerfile: ./Dockerfile
        args:
            XL_IDP_PATH_DOCKER: ${XL_IDP_PATH_DOCKER}
        command:
        bash -c "sh ${XL_IDP_PATH_DOCKER}/bash/run_rzhd.sh"
        networks:
        - postgres
```

```bash
docker-compose up -d --build
```

2. **๐ ะัะพัะผะพัั ะปะพะณะพะฒ:**
```bash
docker-compose logs -f rzhd
```

3. **โน๏ธ ะััะฐะฝะพะฒะบะฐ ัะตัะฒะธัะฐ:**
```bash
docker-compose down
```

#### ๐ณ Docker (ะฐะปััะตัะฝะฐัะธะฒะฝัะน ัะฟะพัะพะฑ)

1. **๐จ ะกะฑะพัะบะฐ ะพะฑัะฐะทะฐ:**
```bash
docker build -t rzhd-scripts .
```

2. **โถ๏ธ ะะฐะฟััะบ ะบะพะฝัะตะนะฝะตัะฐ:**
```bash
docker run -d \
  --name rzhd-processor \
  -v /path/to/data:/data \
  -v /path/to/logs:/app/logging \
  --env-file .env \
  rzhd-scripts
```

#### ๐ป ะะพะบะฐะปัะฝะฐั ัััะฐะฝะพะฒะบะฐ

1. **๐๏ธ ะกะพะทะดะฐะฝะธะต ะฒะธัััะฐะปัะฝะพะณะพ ะพะบััะถะตะฝะธั:**
```bash
python3 -m venv venv
source venv/bin/activate  # Linux/Mac
# ะธะปะธ
venv\Scripts\activate     # Windows
```

2. **๐ฆ ะฃััะฐะฝะพะฒะบะฐ ะทะฐะฒะธัะธะผะพััะตะน:**
```bash
pip install -r requirements.txt
```

3. **๐ ะะฐะฟััะบ ะพะฑัะฐะฑะพัะบะธ:**
```bash
# ะะฐะฟััะบ ะฒัะตั ะผะพะดัะปะตะน
bash/run_rzhd.sh

# ะะฐะฟััะบ ะพัะดะตะปัะฝัั ะผะพะดัะปะตะน
bash/rzhd_ktk.sh
bash/rzhd_weekly.sh
```

### ๐ ะะพะฝัะธะณััะฐัะธั Docker Compose

ะคะฐะนะป `docker-compose.yml` ัะพะดะตัะถะธั ะฟะพะปะฝัั ะบะพะฝัะธะณััะฐัะธั ะดะปั ัะฐะทะฒะตัััะฒะฐะฝะธั ัะธััะตะผั:

- **๐ ะกะตัั**: ะะพะดะบะปััะตะฝะธะต ะบ ะฒะฝะตัะฝะตะน ัะตัะธ `postgres` ะดะปั ะฒะทะฐะธะผะพะดะตะนััะฒะธั ั ะฑะฐะทะพะน ะดะฐะฝะฝัั
- **๐ Volumes**: ะะฒัะพะผะฐัะธัะตัะบะพะต ะผะพะฝัะธัะพะฒะฐะฝะธะต ะดะธัะตะบัะพัะธะน ัะพ ัะบัะธะฟัะฐะผะธ ะธ ะดะฐะฝะฝัะผะธ
- **๐ Restart Policy**: ะะฒัะพะผะฐัะธัะตัะบะธะน ะฟะตัะตะทะฐะฟััะบ ะบะพะฝัะตะนะฝะตัะฐ ะฟัะธ ัะฑะพัั
- **๐ช ะะพััั**: ะญะบัะฟะพัั ะฟะพััะฐ 8100 ะดะปั ะผะพะฝะธัะพัะธะฝะณะฐ (ะฟัะธ ะฝะตะพะฑัะพะดะธะผะพััะธ)
- **๐ Environment**: ะะตัะตะดะฐัะฐ ะฟะตัะตะผะตะฝะฝัั ะพะบััะถะตะฝะธั ะธะท `.env` ัะฐะนะปะฐ

## ๐ ะัะฟะพะปัะทะพะฒะฐะฝะธะต

### ๐ ะกัััะบัััะฐ ะฒัะพะดะฝัั ะดะฐะฝะฝัั

ะกะธััะตะผะฐ ะพะถะธะดะฐะตั Excel ัะฐะนะปั ะฒ ัะปะตะดัััะธั ะดะธัะตะบัะพัะธัั:
```
${XL_IDP_PATH_RZHD}/
โโโ rzhd_ktk/           # ะะขะ ะดะฐะฝะฝัะต
โโโ rzhd_novorossiysk/  # ะะฐะฝะฝัะต ะะพะฒะพัะพััะธะนัะบะฐ  
โโโ rzhd_petersburg/    # ะะฐะฝะฝัะต ะกะะฑ
โโโ rzhd_weekly/        # ะะถะตะฝะตะดะตะปัะฝัะต ะพััะตัั
```

### ๐ ะัะพัะตัั ะพะฑัะฐะฑะพัะบะธ

1. **๐ ะะพะฝะธัะพัะธะฝะณ ัะฐะนะปะพะฒ** - ะกะธััะตะผะฐ ะฐะฒัะพะผะฐัะธัะตัะบะธ ะพััะปะตะถะธะฒะฐะตั ะฝะพะฒัะต .xls/.xlsx/.xlsb ัะฐะนะปั
2. **โ ะะฐะปะธะดะฐัะธั** - ะัะพะฒะตัะบะฐ ััััะบัััั ะธ ัะพะดะตัะถะธะผะพะณะพ ัะฐะนะปะพะฒ
3. **๐ ะะพะฝะฒะตััะฐัะธั** - ะัะตะพะฑัะฐะทะพะฒะฐะฝะธะต ะดะฐะฝะฝัั ะฒ JSON ั ะฝะพัะผะฐะปะธะทะฐัะธะตะน
4. **๐ค ะะฐะณััะทะบะฐ** - ะัะฟัะฐะฒะบะฐ ะดะฐะฝะฝัั ะฒ ClickHouse
5. **๐ฆ ะััะธะฒะธัะพะฒะฐะฝะธะต** - ะะตัะตะผะตัะตะฝะธะต ะพะฑัะฐะฑะพัะฐะฝะฝัั ัะฐะนะปะพะฒ ะฒ ะฟะฐะฟะบั `done/`
6. **๐ข ะฃะฒะตะดะพะผะปะตะฝะธั** - ะัะฟัะฐะฒะบะฐ ััะฐัััะฐ ะพะฑัะฐะฑะพัะบะธ ะฒ Telegram

### ๐ ะคะพัะผะฐั ะฒััะพะดะฝัั ะดะฐะฝะฝัั

ะะฑัะฐะฑะพัะฐะฝะฝัะต ะดะฐะฝะฝัะต ัะพััะฐะฝััััั ะฒ JSON ัะพัะผะฐัะต ัะพ ััะฐะฝะดะฐััะธะทะพะฒะฐะฝะฝัะผะธ ะฟะพะปัะผะธ:
```json
{
  "departure_date": "2024-01-15",
  "arrival_date": "2024-01-20", 
  "cargo_name": "ะะพะฝัะตะนะฝะตั 20 ัััะพะฒ",
  "shipper_okpo": "12345678",
  "consignee_okpo": "87654321",
  "transportation_volume_tons": 25.5,
  "wagon_number": "12345678",
  "container_no": "ABCD1234567"
}
```

## ๐ ะะพะฝะธัะพัะธะฝะณ ะธ ะปะพะณะธัะพะฒะฐะฝะธะต

### ๐ ะะพะณะธ
ะะพะณะธ ัะพััะฐะฝััััั ะฒ ะดะธัะตะบัะพัะธะธ `${XL_IDP_ROOT_RZHD}/logging/`:
- ๐ `rzhd.log` - ะัะฝะพะฒะฝัะต ะพะฟะตัะฐัะธะธ
- ๐ฆ `rzhd_ktk.log` - ะะขะ ะพะฑัะฐะฑะพัะบะฐ
- ๐ `rzhd_weekly.log` - ะะถะตะฝะตะดะตะปัะฝะฐั ะพะฑัะฐะฑะพัะบะฐ

### ๐จ ะะพะฝะธัะพัะธะฝะณ ะพัะธะฑะพะบ
- โ ะัะธะฑะพัะฝัะต ัะฐะนะปั ะฟะตัะตะธะผะตะฝะพะฒัะฒะฐัััั ั ะฟัะตัะธะบัะพะผ `error_`
- ๐ข ะฃะฒะตะดะพะผะปะตะฝะธั ะพ ะบัะธัะธัะตัะบะธั ะพัะธะฑะบะฐั ะพัะฟัะฐะฒะปััััั ะฒ Telegram
- ๐ ะะตัะฐะปัะฝะพะต ะปะพะณะธัะพะฒะฐะฝะธะต ะฒัะตั ะพะฟะตัะฐัะธะน

## ๐จโ๐ป ะะฐะทัะฐะฑะพัะบะฐ

### ๐๏ธ ะกัััะบัััะฐ ะบะปะฐััะพะฒ

#### ๐ ะะฐะทะพะฒัะน ะบะปะฐัั `Rzhd`
```python
class Rzhd:
    def __init__(self, filename: str, folder: str)
    def convert_to_float(value: str) -> Union[float, None]
    def convert_to_int(value: str) -> Union[int, None]
    def divide_chunks(list_data: list, chunk: int) -> Generator
```

#### ๐ง ะกะฟะตัะธะฐะปะธะทะธัะพะฒะฐะฝะฝัะต ะบะปะฐััั
- ๐ฆ `RzhdKTK(Rzhd)` - ะะฑัะฐะฑะพัะบะฐ ะบะพะฝัะตะนะฝะตัะฝัั ะดะฐะฝะฝัั
- ๐ `RzhdWeekly(Rzhd)` - ะะถะตะฝะตะดะตะปัะฝะฐั ะฐะณัะตะณะฐัะธั

### โ ะะพะฑะฐะฒะปะตะฝะธะต ะฝะพะฒะพะณะพ ัะธะฟะฐ ะพะฑัะฐะฑะพัะบะธ

1. **๐ ะกะพะทะดะฐะนัะต ะฝะพะฒัะน Python ะผะพะดัะปั** ะฒ `scripts/`
2. **๐ ะะฐัะปะตะดัะนัะตัั ะพั ะฑะฐะทะพะฒะพะณะพ ะบะปะฐััะฐ** `Rzhd`
3. **๐ ะะพะฑะฐะฒััะต bash ัะบัะธะฟั** ะฒ `bash/`
4. **๐ ะะฑะฝะพะฒะธัะต ะณะปะฐะฒะฝัะน ัะบัะธะฟั** `run_rzhd.sh`

### ๐งช ะขะตััะธัะพะฒะฐะฝะธะต

```bash
# ะะฐะฟััะบ ะพัะดะตะปัะฝะพะณะพ ะผะพะดัะปั ะดะปั ัะตััะธัะพะฒะฐะฝะธั
python3 scripts/rzhd_ktk.py /path/to/test/file.xlsx /path/to/output/

# ะัะพะฒะตัะบะฐ ะปะพะณะพะฒ
tail -f logging/rzhd_ktk.log
```